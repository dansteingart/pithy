"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function readPkgName(e){var r=require(_path2["default"].join(e,"package.json"));return r.name}function getMissing(e,r){return e.filter(function(e){return-1===r.indexOf(e.name)?(r.push(e.name),!0):!1})}Object.defineProperty(exports,"__esModule",{value:!0});var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),ls=function(){var e=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function r(e){var t,n,a=this;return _regenerator2["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,readdir(e);case 2:return t=r.sent,r.next=5,_promise2["default"].all(t.map(function(){var r=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function t(r){var n,u;return _regenerator2["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=_path2["default"].join(e,r),t.next=3,_fsPromise2["default"].realpath(n);case 3:return u=t.sent,t.abrupt("return",{entry:r,path:n,realPath:u});case 5:case"end":return t.stop()}},t,a)}));return function(e){return r.apply(this,arguments)}}()));case 5:return n=r.sent,r.abrupt("return",{shas:n.filter(function(e){return"."!==e.entry.charAt(0)&&e.path===e.realPath}),links:n.filter(function(e){return"."!==e.entry.charAt(0)&&e.path!==e.realPath})});case 7:case"end":return r.stop()}},r,this)}));return function(r){return e.apply(this,arguments)}}(),createSymlink=function(){var e=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function r(e){var t;return _regenerator2["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=_path2["default"].join(process.cwd(),"node_modules",e.name),r.next=3,(0,_forceSymlink2["default"])(e.realPath,t,_config2["default"].symlinkType);case 3:case"end":return r.stop()}},r,this)}));return function(r){return e.apply(this,arguments)}}(),_path=require("path"),_path2=_interopRequireDefault(_path),_fsPromise=require("fs-promise"),_fsPromise2=_interopRequireDefault(_fsPromise),_es6Promisify=require("es6-promisify"),_es6Promisify2=_interopRequireDefault(_es6Promisify),_readdirScopedModules=require("readdir-scoped-modules"),_readdirScopedModules2=_interopRequireDefault(_readdirScopedModules),_forceSymlink=require("./force-symlink"),_forceSymlink2=_interopRequireDefault(_forceSymlink),_config=require("./config"),_config2=_interopRequireDefault(_config),readdir=(0,_es6Promisify2["default"])(_readdirScopedModules2["default"]);exports["default"]=function(){function e(){return r.apply(this,arguments)}var r=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function t(){var e,r,n;return _regenerator2["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=_path2["default"].join(process.cwd(),"node_modules"),t.next=3,ls(e);case 3:return r=t.sent,r.shas.forEach(function(e){e.name=readPkgName(e.realPath)}),n=getMissing(r.shas,r.links.map(function(e){return e.entry})),t.abrupt("return",_promise2["default"].all(n.map(createSymlink)));case 7:case"end":return t.stop()}},t,this)}));return e}();