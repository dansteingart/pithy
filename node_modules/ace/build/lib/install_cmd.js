"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r["default"]=e,r}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function readDepsFromPkgJSON(e,r){var t=require(_path2["default"].join(e,"package.json")),n=void 0;if(r.only){var a={prod:"dependencies",production:"dependencies",dev:"devDependencies",development:"devDependencies"}[r.only]||r.only;n=t[a]||{}}var i=n||(0,_assign2["default"])({},t.dependencies,t.devDependencies,t.optionalDependencies),u=(0,_keys2["default"])(i).map(function(e){return[e,i[e]]});return u}function readDepsFromArgv(e){return e._.slice(1).map(function(e){var r=/^(@?.+?)(?:@(.+)?)?$/.exec(e);return[r[1],r[2]||"*"]})}Object.defineProperty(exports,"__esModule",{value:!0});var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_keys=require("babel-runtime/core-js/object/keys"),_keys2=_interopRequireDefault(_keys),_assign=require("babel-runtime/core-js/object/assign"),_assign2=_interopRequireDefault(_assign),_path=require("path"),_path2=_interopRequireDefault(_path),_expose=require("./expose"),_expose2=_interopRequireDefault(_expose),_install=require("./install"),_install2=_interopRequireDefault(_install),_save=require("./save"),_save2=_interopRequireDefault(_save),_cache=require("./cache"),cache=_interopRequireWildcard(_cache),_flattenTree=require("./flatten-tree"),_flattenTree2=_interopRequireDefault(_flattenTree),_invokeScripts=require("./invoke-scripts"),_invokeScripts2=_interopRequireDefault(_invokeScripts),_createNpm3Symlinks=require("./create-npm3-symlinks"),_createNpm3Symlinks2=_interopRequireDefault(_createNpm3Symlinks);exports["default"]=function(){function e(e,t,n){return r.apply(this,arguments)}var r=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function t(e,r,n){var a,i,u,s,o=this;return _regenerator2["default"].wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=_path2["default"].join(e,"node_modules"),i=r._.length>1,u=i?readDepsFromArgv(r):readDepsFromPkgJSON(e,r),t.next=5,cache.init();case 5:return t.next=7,_promise2["default"].all(u.map(function(){var e=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function r(e){var t,n;return _regenerator2["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=e[0],n=e[1],r.prev=2,r.next=5,(0,_install2["default"])(a,t,n);case 5:return r.abrupt("return",r.sent);case 8:if(r.prev=8,r.t0=r["catch"](2),"LOCKED"===r.t0.code){r.next=12;break}throw r.t0;case 12:case"end":return r.stop()}},r,o,[[2,8]])}));return function(r){return e.apply(this,arguments)}}()));case 7:return t.t0=function(e){return!!e},s=t.sent.filter(t.t0),t.prev=9,t.next=12,(0,_expose2["default"])(a,s);case 12:t.next=16;break;case 14:t.prev=14,t.t1=t["catch"](9);case 16:if(!r.save){t.next=19;break}return t.next=19,(0,_save2["default"])(e,"dependencies",u);case 19:if(!r["save-dev"]){t.next=22;break}return t.next=22,(0,_save2["default"])(e,"devDependencies",u);case 22:return t.next=24,(0,_invokeScripts2["default"])(s);case 24:return t.next=26,(0,_createNpm3Symlinks2["default"])();case 26:case"end":return t.stop()}},t,this,[[9,14]])}));return e}();